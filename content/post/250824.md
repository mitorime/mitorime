---
title: "作業記録: ダークモードに対応した"
writtenby: mitori
writericon: https://lh3.googleusercontent.com/pw/AP1GczNeuXp9DkkgRYUAVLpBQ5p86tIPlGBZTqeGdFkd3TSFo4Gwm81qaa3j9p0-XMVMilkKqxEIsrSRBdazwscW7i7zDWcS5kCj-5xbaKFdRQ_v19RQIuB9ZH7QTuGx2LeQWjpEvgI_4lCcjNrOor53aDO4=w400-h400-s-no
date: 2025.08.24
updated: 2025.08.24
eyecatch: https://lh3.googleusercontent.com/pw/AP1GczMKl-5VOmaPuTpECK5mPsiKSXlQ1r-B2FC011kg19N6DbJy13ihbh503RP9_XnK0q4eBS0Q-cIPQVPyBapV4HLbZZA0ek2nRTLONM6BD194XfSdvoOJyXEw0kXdamjaXRnTH1TwU86GXAbYEsNYHWEe=w1600-h838-s-no
categories: devlog
tags: [ミトリメ, 進捗報告, おぼえがき, 色彩設計]
pin: false
hidden: false
warning: false
bgColor: "background-color: #191b20;"
metaColor: "background-color: #8b8f9f;"
---

<h1 style="color: #b7b9c1; border-color: #606473;">重い腰を上げた</h1>

ミトリメが<mark style="background-color: #32353f;">ダークモードに対応</mark>しました。
この記事では例として、**端末の設定にかかわらず擬似的にダークモードを再現して**お送りします。

技術的制約により一部再現しきれない箇所があるので、そこは<mark style="background-color: #32353f;">ご自身の端末でダークモードをオンオフして</mark>お確かめください。うっさい。できねーもんはできねーんじゃ。

いや、本当は対応する気なんてなかったんですが (ライトモードの色彩がいたく気に入っているので) 、夜中布団にくるまって読むときにだいぶ目が痛いのに耐えきれず、とうとう実装した次第です。
本当に対応する気がなかったので、これまでサイト内の各カラー指定は Sass 変数 <code style="background-color: #32353f;">例: $foo: #baaa12;</code> で行なっていましたが* 、これを機にすべて CSS 変数 <code style="background-color: #32353f;">例: var(--bar);</code> に統一しました。

<blockquote style="background-color: #32353f;"> 註: Sass 変数は、<strong>ビルド時に静的な値に置換されるのみ</strong>で、ブラウザでの実行時になにか動的な挙動を示したりはしない</blockquote>

<h2 style="color: #b7b9c1; border-color: #606473;">悩んだとこ</h2>
<h3 style="color: #b7b9c1; border-color: #606473;">色</h3>

本当に色すぎる。

色を決めるのに1時間以上かけています。モノトーンの3色を新規制定するのに1時間。うっさい。アクセシビリティとかコントラスト比とかいろいろあるんじゃ。

そもそもミトリメで使っているグレーは単調なグラデーションではなく、一色ごとに色調 (Hue のほう) や彩度を微妙に調整しており、今回もその微調整をやりまくりました。だからやりたくなかったんだ。でも、こういうところに宿りますから。神が。

備忘録がてら、やり方を書いておきます。

色彩設計で、明度のみが異なる同色調・同彩度の色を作るとき、わたしは HSL や HSV ではなく **LAB で調整を行うことが多い**です。
理由はひとつ。**LAB が人間の視覚に近くなるように設計されている**から。

<blockquote style="background-color: #32353f;">RGBやCMYKとは異なり、Lab色空間は人間の視覚を近似するよう設計されている。<br>
知覚的均等性を重視しており、L成分値は人間の明度の知覚と極めて近い。<br>
したがって、カラーバランス調整を正確に行うために出力曲線を a および b の成分で表現したり、コントラストの調整のためにL成分を使ったりといった利用が可能である。RGBやCMYKは人間の知覚よりも出力機器の都合が優先されており、これらの変換は編集ソフトの適切なブレンドモードの補助が必須である。
<br><br>
_ <a href="https://ja.wikipedia.org/wiki/Lab色空間">Wikipedia/Lab色空間</a>より引用</blockquote>

まあ要は HSL でやるよりパッと見の色合いの調整がラクっちゅーことですね。

基本的には、もともとのグレー (ここの文字色です) から A / B スライダは動かさず、L (明度) だけを下げて、最後に実際の色合いを見ながら HSL で微妙に彩度を弱めました。無彩色すぎず有彩色すぎないニュートラルな感じを保ちたかったので……
ここのラインを探るのがすごく疲れる。
彩度を 1 / 256 単位で調整する作業を繰り返したので目がバキバキになりました。

ちなみに、こういう作業はふだん iPad 版 Affinity Designer で行なっていますが、最近わたしの iPad Pro 2018 12.9 inch (命名・鼻毛、7歳) のディスプレイが尿液晶でへたってきて音ゲー専用機と化しているため、最近購入した MacBook Air M3 2024 13 inch (命名・オワコンモバイル (終わったコンピュータモバイル)) でやりました。

カラープロファイルは Display P3 を使用しています。

<h3 style="color: #b7b9c1; border-color: #606473;">実装</h3>

ただ <code style="background-color: #32353f;">@media (prefers-color-scheme: dark) { :root { ... } }</code> すればいいってもんじゃないんだな、これが。
さっきも言ったとおり、もともと Sass 変数を使用していたのもありましたが、そこではない。
単に色を置き換えただけではデザイン上ビミョーな箇所がいくつか出てくるんですね。

具体的にはタグとかカテゴリとか、背景色ありの文字を使用しているところ、<a href="https://mitori.me/post/250401">この記事</a>のように背景色を個別で指定しているページなどです。

前者は<mark style="background-color: #32353f;">あえて Sass 変数のまま色を指定してダークモードの影響を受けないように</mark>しました。仕様を逆手に取った感じ。
それと一部ライトモードとは割り当てる色を変えたり、あえてライトモードの色を指定したり。

後者は Markdown の自動レンダリングではなく<mark style="background-color: #32353f;">記事内で手動でタグを設定して絶対色指定にする</mark>とか。

あとは見出しの文字色も白くしています。ライトモードでは見出しも本文もグレーで統一していますが、ダークモードでは黒背景にグレー文字となるので<mark style="background-color: #32353f;">見出しがどこなのか判別しにくい</mark>。グレーの色値はライトモードと共通にしたかったので、こういったところでコントラストを調整しました。

<h3 style="color: #b7b9c1; border-color: #606473;">CSS の仕様</h3>

備忘録としてはここが本編かも。

ミトリメではリンクの下線は文字色と同じグレーを使用していますが、ここを Sass 変数 <code style="background-color: #32353f;">$foo;</code> から CSS 変数 <code style="background-color: #32353f;">var(--bar);</code> に変えた瞬間**下線が表示されなくなりました**。なんでだ。

具体的な記述は以下。

<pre style="background-color: #32353f;">
text-decoration: underline solid $light_content;
</pre>

これを

<pre style="background-color: #32353f;">
text-decoration: underline solid var(--content-color);
</pre>

こうしたら表示されなくなりました。

<pre style="background-color: #32353f;">
text-decoration: underline solid;
text-decoration-color: var(--content-color);
</pre>

こうしたら表示された。

<h4 style="color: #b7b9c1; border-color: #606473;">こたえ</h4>

先述のとおり、Sass 変数は**ビルド時に静的な値にコンパイルされます**。
つまり Sass 変数で色を指定すれば、ブラウザ側には <code style="background-color: #32353f;">text-decoration: underline solid #baaa12;</code> のように渡されます。
これはどう見ても色ですね。

ですが、CSS 変数を指定した場合、ブラウザ側では渡された変数 <code style="background-color: #32353f;">var(--content-color);</code> が**必ずしも色であると確定 (解決) できず、普通にガン無視されます**。
しかもブラウザによるらしい。Safari (Mac, iOS) はダメでした。
偏見だけど Safari はこういうとこ弱いよね。

代わりに <code style="background-color: #32353f;">text-decoration-color: var(--content-color);</code> と記述すれば、ブラウザは**一発で色と認識する** (というか color プロパティに渡されているので色でしかない) ので、CSS 変数で渡されても問題ない、ということみたいです。
ショートハンドの記述が便利でも、**CSS 変数を使うなら一応ロングハンドで分けといた方が無難である**と言えそうです。

普通に不便だからやめろよそういうの

<blockquote style="background-color: #32353f;"> 註: 一括指定プロパティ <code style="background-color: #32353f;">text-decoration</code> は、値を書く順番は自由なので、そこは原因ではないっぽい (一応 <a href="https://developer.mozilla.org/ja/docs/Web/CSS/text-decoration">Mozilla のドキュメント</a>によると <code style="background-color: #32353f;"> line style color thickness</code> の順)</blockquote>

**完**
